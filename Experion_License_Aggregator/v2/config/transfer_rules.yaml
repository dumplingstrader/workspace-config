# Transfer Candidate Detection Rules

# Purpose: Define criteria for identifying systems with excess capacity
# Used to find licenses available for transfer to other systems

---

# Transfer Candidate Criteria
# System must meet at least ONE condition per license type

criteria:
  
  # Process Points
  PROCESSPOINTS:
    - name: "Absolute Excess"
      type: absolute
      threshold: 500
      description: "At least 500 unused process points"
      enabled: true
    
    - name: "Percentage Excess"
      type: percentage
      threshold: 25
      description: "Less than 75% utilization (>25% excess)"
      enabled: true
    
    - name: "Minimum Value"
      type: value
      threshold: 1000.00
      description: "Excess capacity worth at least $1,000"
      enabled: true
  
  # SCADA Points
  SCADAPOINTS:
    - name: "Absolute Excess"
      type: absolute
      threshold: 500
      enabled: true
    
    - name: "Percentage Excess"
      type: percentage
      threshold: 25
      enabled: true
    
    - name: "Minimum Value"
      type: value
      threshold: 1000.00
      enabled: true
  
  # Direct/Console Stations
  DIRECTSTATIONS:
    - name: "Absolute Excess"
      type: absolute
      threshold: 2  # Even 2 extra stations can be valuable
      enabled: true
    
    - name: "Percentage Excess"
      type: percentage
      threshold: 25
      enabled: true
    
    - name: "Minimum Value"
      type: value
      threshold: 5000.00  # Stations are expensive
      enabled: true
  
  # Standard Stations
  STATIONS:
    - name: "Absolute Excess"
      type: absolute
      threshold: 2
      enabled: true
    
    - name: "Percentage Excess"
      type: percentage
      threshold: 25
      enabled: true
    
    - name: "Minimum Value"
      type: value
      threshold: 3000.00
      enabled: true
  
  # Multi-Stations
  MULTISTATIONS:
    - name: "Absolute Excess"
      type: absolute
      threshold: 2
      enabled: true
    
    - name: "Percentage Excess"
      type: percentage
      threshold: 25
      enabled: true
    
    - name: "Minimum Value"
      type: value
      threshold: 3000.00
      enabled: true

---

# License Types to Check
# Only check these types for transfer potential
license_types:
  - PROCESSPOINTS
  - SCADAPOINTS
  - DIRECTSTATIONS
  - STATIONS
  - MULTISTATIONS
  # Note: Don't check boolean features (DUAL, DAS, API) - not transferable

---

# Exclusion Rules
# Systems that should NOT be flagged as transfer candidates
exclusions:
  
  # Exclude systems without usage data
  require_usage_data: true
  
  # Exclude systems with low match confidence
  min_match_confidence: 0.8
  
  # Exclude new systems (might not be fully utilized yet)
  exclude_new_systems:
    enabled: true
    license_age_threshold_days: 90  # Exclude if licensed <90 days ago
  
  # Exclude systems in specific clusters (if needed)
  exclude_clusters: []  # e.g., ["Test Lab", "Development"]
  
  # Exclude specific systems by MSID
  exclude_msids: []  # e.g., ["M9999-TEST"]

---

# Prioritization Rules
# Rank transfer candidates by value
prioritization:
  
  # Sort order for report
  sort_by:
    - field: excess_value
      order: desc
    - field: excess
      order: desc
    - field: utilization_percent
      order: asc
  
  # Highlight top candidates
  top_candidates:
    count: 10
    highlight_in_report: true
  
  # Color coding in Excel
  color_coding:
    high_value:
      threshold: 10000.00
      color: green
      description: ">$10k excess value"
    
    medium_value:
      threshold: 5000.00
      color: yellow
      description: "$5k-$10k excess value"
    
    low_value:
      threshold: 1000.00
      color: orange
      description: "$1k-$5k excess value"

---

# Reporting Options
reporting:
  
  # Include in report
  include_fields:
    - cluster
    - system_name
    - msid
    - system_number
    - license_type
    - licensed
    - used
    - excess
    - utilization_percent
    - excess_value
    - has_usage_data
    - match_confidence
    - criteria_met  # Which criteria triggered inclusion
  
  # Group by
  group_by: cluster
  
  # Summary statistics
  summary:
    - total_candidates
    - total_excess_value
    - avg_utilization
    - by_license_type
    - by_cluster
  
  # Export formats
  outputs:
    - excel_sheet: "Transfer Candidates"
    - json_file: "transfer_candidates.json"
    - csv_file: "transfer_candidates.csv"

---

# Validation Rules
validation:
  
  # Sanity checks
  sanity_checks:
    # Excess should never be negative
    excess_non_negative: true
    
    # Utilization should be 0-100%
    utilization_valid_range: [0, 100]
    
    # Excess value should be positive
    excess_value_positive: true
  
  # Warning thresholds
  warnings:
    # Warn if utilization > 100% (data error)
    over_utilization:
      threshold: 100
      message: "Usage exceeds licensed - verify data accuracy"
    
    # Warn if many candidates from one system
    excessive_candidates:
      threshold: 5
      message: "System has >5 license types flagged - verify licensing strategy"

---

# Transfer Candidate Analysis
# Additional analysis for transfer planning
analysis:
  
  # Calculate transfer scenarios
  scenarios:
    enabled: true
    
    # What-if analysis: If we transfer X%, what's the utilization?
    transfer_percentages: [25, 50, 75]
    
    # Calculate cost savings from transfers
    calculate_savings: true
  
  # Compatibility checking
  compatibility:
    # Check if target system can accept transfer
    check_release_compatibility: true
    
    # Warn about transfer restrictions
    restrictions:
      - "Check license transfer policy with Honeywell"
      - "Verify systems are in same customer account"
      - "Confirm release compatibility"

---

# Historical Tracking
# Track transfer candidates over time
historical:
  
  # Compare with previous runs
  compare_with_history: true
  
  # Track changes
  track_changes:
    - excess_increased
    - excess_decreased
    - new_candidate
    - no_longer_candidate
  
  # Trend analysis
  trends:
    enabled: true
    lookback_months: 12
    report_trends: true
